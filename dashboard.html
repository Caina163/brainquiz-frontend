<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Inicial - BrainQuiz</title>
    <style>
        body {
            background: linear-gradient(135deg, #000 0%, #1a1a2e 50%, #16213e 100%);
            color: #0af;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #0af;
            border-radius: 50%;
            animation: float 8s infinite linear;
            box-shadow: 0 0 10px #0af;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto 20px;
            background: rgba(17, 17, 17, 0.8);
            padding: 20px 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 170, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.2);
        }
        
        h1 {
            margin: 0;
            text-shadow: 0 0 20px #0af;
            font-size: 2.5rem;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 20px #0af; }
            50% { text-shadow: 0 0 40px #0af, 0 0 60px #0af; }
        }
        
        .header-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        #createQuizBtn, #exitBtn {
            background: linear-gradient(45deg, #0af, #08c);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.3);
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        #createQuizBtn:hover, #exitBtn:hover {
            background: linear-gradient(45deg, #08c, #0af);
            color: #fff;
            box-shadow: 0 8px 30px rgba(0, 170, 255, 0.6);
            transform: translateY(-3px);
        }
        
        #exitBtn {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.3);
        }
        
        #exitBtn:hover {
            background: linear-gradient(45deg, #cc0000, #ff4444);
            box-shadow: 0 8px 30px rgba(255, 68, 68, 0.6);
        }
        
        #tabs {
            max-width: 1200px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            background: rgba(17, 17, 17, 0.6);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 170, 255, 0.2);
        }
        
        .tab-button {
            background: rgba(34, 34, 34, 0.8);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: #0af;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.2);
            font-weight: bold;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .tab-button.active, .tab-button:hover {
            background: linear-gradient(45deg, #0af, #08c);
            color: #000;
            box-shadow: 0 8px 25px rgba(0, 170, 255, 0.4);
            transform: translateY(-2px);
        }
        
        #quizzesContainer {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 200px;
        }
        
        .section-title {
            color: #0af;
            font-size: 1.8rem;
            margin: 0 0 20px 0;
            text-shadow: 0 0 15px #0af;
            border-bottom: 3px solid #0af;
            padding: 15px;
            text-align: center;
            background: linear-gradient(90deg, transparent, rgba(0,170,255,0.1), transparent);
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 170, 255, 0.3);
        }
        
        .items-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .quiz-card, .user-card, .pdf-card {
            background: rgba(17, 17, 17, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,170,255,0.2);
            padding: 20px;
            width: 280px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,170,255,0.3);
            backdrop-filter: blur(10px);
        }
        
        .quiz-card:hover, .user-card:hover, .pdf-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,170,255,0.4);
            border-color: #0af;
        }
        
        .quiz-title, .user-title, .pdf-card-name {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #0af;
            text-shadow: 0 0 5px rgba(0,170,255,0.5);
        }
        
        .quiz-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid rgba(0,170,255,0.3);
        }
        
        .user-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #0af, #08c);
            color: #000;
            font-weight: bold;
            font-size: 2rem;
            overflow: hidden;
            border: 3px solid rgba(0,170,255,0.5);
        }
        
        .user-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-administrador {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: #000;
        }
        
        .badge-moderador {
            background: linear-gradient(45deg, #ffa726, #ffcc02);
            color: #000;
        }
        
        .badge-aluno {
            background: linear-gradient(45deg, #66bb6a, #81c784);
            color: #000;
        }
        
        .empty-message {
            font-style: italic;
            color: #666;
            width: 100%;
            text-align: center;
            margin-top: 40px;
            padding: 40px;
            background: rgba(0,170,255,0.05);
            border-radius: 15px;
            border: 2px dashed rgba(0,170,255,0.2);
            backdrop-filter: blur(5px);
        }
        
        .loading {
            text-align: center;
            color: #0af;
            font-style: italic;
            padding: 40px;
            animation: pulse 2s infinite;
        }
        
        .error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(255, 68, 68, 0.3);
            backdrop-filter: blur(5px);
        }
        
        #mensagemSucesso {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #0af, #08c);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,170,255,0.4);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        #mensagemSucesso.show {
            opacity: 1;
            transform: translateX(0);
        }

        .user-info {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 170, 255, 0.2);
            color: #0af;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #0af;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 1000;
            max-width: 300px;
            border: 1px solid rgba(0, 170, 255, 0.3);
        }

        .upload-area {
            border: 2px dashed rgba(0,170,255,0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,170,255,0.05);
        }

        .upload-area:hover {
            border-color: #0af;
            background: rgba(0,170,255,0.1);
        }

        .upload-area.dragover {
            border-color: #0af;
            background: rgba(0,170,255,0.2);
            transform: scale(1.02);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-approve {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: #fff;
        }

        .btn-reject {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: #fff;
        }

        .btn-edit {
            background: linear-gradient(45deg, #ffc107, #ffca2c);
            color: #000;
        }

        .btn-archive {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: #fff;
        }

        .btn-delete {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: #fff;
        }

        .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .edit-field {
            background: rgba(34, 34, 34, 0.8);
            border: 1px solid rgba(0,170,255,0.3);
            border-radius: 5px;
            padding: 8px;
            color: #0af;
            width: 100%;
            margin: 5px 0;
        }

        .calendario-container {
            background: rgba(17, 17, 17, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            border: 1px solid rgba(0, 170, 255, 0.3);
        }

        .calendario-form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            color: #0af;
            margin-bottom: 5px;
            font-weight: bold;
        }

        .form-group input, .form-group select {
            background: rgba(34, 34, 34, 0.8);
            border: 1px solid rgba(0,170,255,0.3);
            border-radius: 8px;
            padding: 12px;
            color: #0af;
            font-size: 1rem;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #0af;
            box-shadow: 0 0 10px rgba(0,170,255,0.3);
        }

        .perfil-container {
            background: rgba(17, 17, 17, 0.9);
            border-radius: 15px;
            padding: 30px;
            margin: 20px auto;
            max-width: 600px;
            border: 1px solid rgba(0, 170, 255, 0.3);
        }

        .perfil-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            margin: 0 auto 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #0af, #08c);
            color: #000;
            font-weight: bold;
            font-size: 3rem;
            overflow: hidden;
            border: 4px solid rgba(0,170,255,0.5);
        }

        .perfil-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .perfil-info {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: rgba(34, 34, 34, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(0,170,255,0.2);
        }

        .info-label {
            color: #0af;
            font-weight: bold;
        }

        .info-value {
            color: #fff;
        }

        .trash-item {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
        }
        
        @media (max-width: 768px) {
            .items-grid {
                justify-content: center;
            }
            
            .quiz-card, .user-card, .pdf-card {
                width: 90%;
                max-width: 350px;
            }
            
            #tabs {
                justify-content: center;
            }
            
            .section-title {
                flex-direction: column;
                gap: 15px;
            }

            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .header-buttons {
                justify-content: center;
            }

            .calendario-form {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    
    <!-- Debug Info -->
    <div class="debug-info" id="debugInfo">
        üîß Status: Inicializando...
    </div>
    
    <div class="user-info" id="userInfo">
        üë§ Carregando...
    </div>
    
    <header>
        <h1>üß† BrainQuiz - Painel</h1>
        <div class="header-buttons">
            <button id="createQuizBtn" title="Criar novo quiz">üìù Criar Quiz</button>
            <button id="exitBtn" title="Sair do sistema">üö™ Sair</button>
        </div>
    </header>
    
    <div id="tabs">
        <button class="tab-button active" data-tab="ativos">üéØ Quizzes Ativos</button>
        <button class="tab-button" data-tab="arquivados">üìÅ Arquivados</button>
        <button class="tab-button" data-tab="lixeira">üóëÔ∏è Lixeira</button>
        <button class="tab-button" data-tab="usuarios">üë• Usu√°rios</button>
        <button class="tab-button" data-tab="cadastros">‚è≥ Cadastros Pendentes</button>
        <button class="tab-button" data-tab="pdfs">üìÑ PDFs</button>
        <button class="tab-button" data-tab="calendario">üìÖ Calend√°rio</button>
        <button class="tab-button" data-tab="perfil">üë§ Meu Perfil</button>
    </div>

    <main id="mainContainer">
        <div id="quizzesContainer"></div>
    </main>

    <div id="mensagemSucesso"></div>

    <script>
        console.log('üöÄ DASHBOARD COMPLETAMENTE CORRIGIDO - BrainQuiz v4.0');

        // ============================================================================
        // CONFIGURA√á√ÉO DE BOT√ïES E NAVEGA√á√ÉO
        // ============================================================================
        function configurarBotoesPrincipais() {
            console.log('‚öôÔ∏è Configurando bot√µes principais...');
            
            createQuizBtn.onclick = () => {
                console.log('üîÑ Redirecionando para cria√ß√£o de quiz...');
                window.location.href = 'painel.html';
            };

            exitBtn.onclick = async () => {
                if (confirm('Deseja realmente sair do sistema?')) {
                    console.log('üëã Fazendo logout...');
                    updateDebug('Fazendo logout...');
                    
                    try {
                        await fetch('https://brainquiz-backend.onrender.com/api/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });
                    } catch (error) {
                        console.log('‚ö†Ô∏è Erro no logout backend:', error);
                    }
                    
                    localStorage.clear();
                    console.log('üîÑ Redirecionando para index.html...');
                    window.location.href = 'index.html';
                }
            };
        }

        function configurarTabs() {
            const tabs = document.querySelectorAll('.tab-button');
            
            // Configurar visibilidade das abas baseado no tipo de usu√°rio
            if (usuarioLogado.tipo === 'aluno') {
                document.querySelector('[data-tab="usuarios"]').style.display = 'none';
                document.querySelector('[data-tab="cadastros"]').style.display = 'none';
                document.querySelector('[data-tab="arquivados"]').style.display = 'none';
                document.querySelector('[data-tab="lixeira"]').style.display = 'none';
            } else if (usuarioLogado.tipo === 'moderador') {
                document.querySelector('[data-tab="lixeira"]').style.display = 'none';
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tabName;
                    exibirConteudo();
                });
            });
        }

        // ============================================================================
        // SISTEMA DE EXIBI√á√ÉO DE CONTE√öDO - CORRIGIDO
        // ============================================================================
        function exibirConteudo() {
            quizzesContainer.innerHTML = '';

            switch (currentTab) {
                case 'ativos':
                    exibirQuizzesAtivos();
                    break;
                case 'arquivados':
                    exibirArquivados();
                    break;
                case 'lixeira':
                    exibirLixeira();
                    break;
                case 'usuarios':
                    exibirUsuarios();
                    break;
                case 'cadastros':
                    exibirCadastrosPendentes();
                    break;
                case 'pdfs':
                    exibirPDFs();
                    break;
                case 'calendario':
                    exibirCalendario();
                    break;
                case 'perfil':
                    exibirPerfil();
                    break;
                default:
                    quizzesContainer.innerHTML = '<p class="empty-message">Nenhum conte√∫do dispon√≠vel.</p>';
                    break;
            }
        }

        // ============================================================================
        // EXIBI√á√ÉO DE QUIZZES ATIVOS - CORRIGIDA
        // ============================================================================
        function exibirQuizzesAtivos() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üéØ Quizzes Ativos (${quizzesAtivos.length})</span>`;
            quizzesContainer.appendChild(title);

            if (quizzesAtivos.length === 0) {
                quizzesContainer.innerHTML += '<p class="empty-message">Nenhum quiz ativo. Clique em "Criar Quiz" para come√ßar!</p>';
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'items-grid';

            quizzesAtivos.forEach(quiz => {
                const card = criarCardQuiz(quiz, 'ativo');
                grid.appendChild(card);
            });

            quizzesContainer.appendChild(grid);
        }

        // ============================================================================
        // EXIBI√á√ÉO DE ARQUIVADOS - CORRIGIDA
        // ============================================================================
        function exibirArquivados() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üìÅ Itens Arquivados</span>`;
            quizzesContainer.appendChild(title);

            // Se√ß√£o Quizzes Arquivados
            if (quizzesArquivados.length > 0) {
                const quizTitle = document.createElement('h3');
                quizTitle.style.color = '#0af';
                quizTitle.style.margin = '20px 0 15px 0';
                quizTitle.textContent = `üéØ Quizzes Arquivados (${quizzesArquivados.length})`;
                quizzesContainer.appendChild(quizTitle);

                const quizGrid = document.createElement('div');
                quizGrid.className = 'items-grid';

                quizzesArquivados.forEach(quiz => {
                    const card = criarCardQuiz(quiz, 'arquivado');
                    quizGrid.appendChild(card);
                });

                quizzesContainer.appendChild(quizGrid);
            }

            // Se√ß√£o PDFs Arquivados
            if (pdfsArquivados.length > 0) {
                const pdfTitle = document.createElement('h3');
                pdfTitle.style.color = '#0af';
                pdfTitle.style.margin = '20px 0 15px 0';
                pdfTitle.textContent = `üìÑ PDFs Arquivados (${pdfsArquivados.length})`;
                quizzesContainer.appendChild(pdfTitle);

                const pdfGrid = document.createElement('div');
                pdfGrid.className = 'items-grid';

                pdfsArquivados.forEach(pdf => {
                    const card = criarCardPDF(pdf, 'arquivado');
                    pdfGrid.appendChild(card);
                });

                quizzesContainer.appendChild(pdfGrid);
            }

            if (quizzesArquivados.length === 0 && pdfsArquivados.length === 0) {
                quizzesContainer.innerHTML += '<p class="empty-message">Nenhum item arquivado no momento.</p>';
            }
        }

        // ============================================================================
        // EXIBI√á√ÉO DA LIXEIRA - CORRIGIDA
        // ============================================================================
        function exibirLixeira() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üóëÔ∏è Lixeira</span>`;
            quizzesContainer.appendChild(title);

            // Se√ß√£o Quizzes Exclu√≠dos
            if (quizzesExcluidos.length > 0) {
                const quizTitle = document.createElement('h3');
                quizTitle.style.color = '#ff4444';
                quizTitle.style.margin = '20px 0 15px 0';
                quizTitle.textContent = `üéØ Quizzes Exclu√≠dos (${quizzesExcluidos.length})`;
                quizzesContainer.appendChild(quizTitle);

                const quizGrid = document.createElement('div');
                quizGrid.className = 'items-grid';

                quizzesExcluidos.forEach(quiz => {
                    const card = criarCardQuiz(quiz, 'excluido');
                    card.classList.add('trash-item');
                    quizGrid.appendChild(card);
                });

                quizzesContainer.appendChild(quizGrid);
            }

            // Se√ß√£o PDFs Exclu√≠dos
            if (pdfsExcluidos.length > 0) {
                const pdfTitle = document.createElement('h3');
                pdfTitle.style.color = '#ff4444';
                pdfTitle.style.margin = '20px 0 15px 0';
                pdfTitle.textContent = `üìÑ PDFs Exclu√≠dos (${pdfsExcluidos.length})`;
                quizzesContainer.appendChild(pdfTitle);

                const pdfGrid = document.createElement('div');
                pdfGrid.className = 'items-grid';

                pdfsExcluidos.forEach(pdf => {
                    const card = criarCardPDF(pdf, 'excluido');
                    card.classList.add('trash-item');
                    pdfGrid.appendChild(card);
                });

                quizzesContainer.appendChild(pdfGrid);
            }

            if (quizzesExcluidos.length === 0 && pdfsExcluidos.length === 0) {
                quizzesContainer.innerHTML += '<p class="empty-message">A lixeira est√° vazia.</p>';
            }
        }

        // ============================================================================
        // EXIBI√á√ÉO DE USU√ÅRIOS - CORRIGIDA
        // ============================================================================
        function exibirUsuarios() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üë• Usu√°rios Ativos (${users.length})</span>`;
            quizzesContainer.appendChild(title);

            if (users.length === 0) {
                quizzesContainer.innerHTML += '<p class="empty-message">Nenhum usu√°rio ativo encontrado.</p>';
                return;
            }

            const usersGrid = document.createElement('div');
            usersGrid.className = 'items-grid';

            users.forEach(user => {
                const card = criarCardUsuario(user);
                usersGrid.appendChild(card);
            });

            quizzesContainer.appendChild(usersGrid);
        }

        // ============================================================================
        // EXIBI√á√ÉO DE CADASTROS PENDENTES - CORRIGIDA
        // ============================================================================
        function exibirCadastrosPendentes() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>‚è≥ Cadastros Pendentes (${cadastrosPendentes.length})</span>`;
            quizzesContainer.appendChild(title);

            if (cadastrosPendentes.length === 0) {
                quizzesContainer.innerHTML += '<p class="empty-message">Nenhum cadastro pendente no momento.</p>';
                return;
            }
            
            const cadastrosGrid = document.createElement('div');
            cadastrosGrid.className = 'items-grid';
            
            cadastrosPendentes.forEach(cadastro => {
                const card = criarCardCadastroPendente(cadastro);
                cadastrosGrid.appendChild(card);
            });

            quizzesContainer.appendChild(cadastrosGrid);
        }

        // ============================================================================
        // EXIBI√á√ÉO DE PDFs - CORRIGIDA
        // ============================================================================
        function exibirPDFs() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üìÑ Gerenciar PDFs</span>`;
            quizzesContainer.appendChild(title);
            
            // √Årea de Upload - CORRIGIDA
            const uploadArea = document.createElement('div');
            uploadArea.className = 'upload-area';
            uploadArea.innerHTML = `
                <h3 style="color: #0af; margin-bottom: 15px;">üì§ Upload de PDF</h3>
                <p style="color: #0af; margin-bottom: 15px;">Clique aqui ou arraste arquivos PDF para enviar</p>
                <input type="file" id="pdfUpload" accept=".pdf" multiple style="display: none;">
                <button onclick="document.getElementById('pdfUpload').click()" style="background: linear-gradient(45deg, #0af, #08c); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    üìé Selecionar PDFs
                </button>
            `;
            
            // Configurar drag and drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handlePDFUpload(e.dataTransfer.files);
            });
            
            uploadArea.addEventListener('click', () => {
                document.getElementById('pdfUpload').click();
            });
            
            quizzesContainer.appendChild(uploadArea);
            
            // Lista de PDFs Ativos
            if (pdfsAtivos.length > 0) {
                const pdfsTitle = document.createElement('h3');
                pdfsTitle.style.color = '#0af';
                pdfsTitle.style.margin = '30px 0 15px 0';
                pdfsTitle.textContent = `üìÑ PDFs Dispon√≠veis (${pdfsAtivos.length})`;
                quizzesContainer.appendChild(pdfsTitle);

                const pdfsGrid = document.createElement('div');
                pdfsGrid.className = 'items-grid';

                pdfsAtivos.forEach(pdf => {
                    const card = criarCardPDF(pdf, 'ativo');
                    pdfsGrid.appendChild(card);
                });

                quizzesContainer.appendChild(pdfsGrid);
            } else {
                const emptyMessage = document.createElement('p');
                emptyMessage.className = 'empty-message';
                emptyMessage.textContent = 'Nenhum PDF dispon√≠vel. Fa√ßa upload de arquivos PDF para come√ßar.';
                quizzesContainer.appendChild(emptyMessage);
            }
            
            // Configurar input de arquivo
            setTimeout(() => {
                const fileInput = document.getElementById('pdfUpload');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        handlePDFUpload(e.target.files);
                    });
                }
            }, 100);
        }

        // ============================================================================
        // EXIBI√á√ÉO DO CALEND√ÅRIO - CORRIGIDA
        // ============================================================================
        function exibirCalendario() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üìÖ Calend√°rio Acad√™mico</span>`;
            quizzesContainer.appendChild(title);
            
            const container = document.createElement('div');
            container.className = 'calendario-container';
            
            container.innerHTML = `
                <h3 style="color: #0af; margin-bottom: 20px; text-align: center;">üìö Informa√ß√µes Acad√™micas</h3>
                
                <div class="calendario-form">
                    <div class="form-group">
                        <label for="fase">üìä Fase Atual:</label>
                        <select id="fase">
                            <option value="">Selecione a fase</option>
                            <option value="1">1¬™ Fase</option>
                            <option value="2">2¬™ Fase</option>
                            <option value="3">3¬™ Fase</option>
                            <option value="4">4¬™ Fase</option>
                            <option value="5">5¬™ Fase</option>
                            <option value="6">6¬™ Fase</option>
                            <option value="7">7¬™ Fase</option>
                            <option value="8">8¬™ Fase</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="periodo">‚è∞ Per√≠odo:</label>
                        <select id="periodo">
                            <option value="">Selecione o per√≠odo</option>
                            <option value="matutino">Matutino</option>
                            <option value="vespertino">Vespertino</option>
                            <option value="noturno">Noturno</option>
                            <option value="integral">Integral</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="modulo">üìñ M√≥dulo:</label>
                        <select id="modulo">
                            <option value="">Selecione o m√≥dulo</option>
                            <option value="1">M√≥dulo 1</option>
                            <option value="2">M√≥dulo 2</option>
                            <option value="3">M√≥dulo 3</option>
                            <option value="4">M√≥dulo 4</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="semestre">üìÖ Semestre:</label>
                        <select id="semestre">
                            <option value="">Selecione o semestre</option>
                            <option value="2024.1">2024.1</option>
                            <option value="2024.2">2024.2</option>
                            <option value="2025.1">2025.1</option>
                            <option value="2025.2">2025.2</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="inicioSemestre">üìÖ In√≠cio do Semestre:</label>
                        <input type="date" id="inicioSemestre">
                    </div>
                    
                    <div class="form-group">
                        <label for="fimSemestre">üìÖ Fim do Semestre:</label>
                        <input type="date" id="fimSemestre">
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button onclick="salvarCalendario()" style="background: linear-gradient(45deg, #0af, #08c); color: #000; border: none; padding: 15px 30px; border-radius: 10px; font-weight: bold; cursor: pointer; font-size: 1.1rem;">
                        üíæ Salvar Calend√°rio
                    </button>
                </div>
            `;
            
            quizzesContainer.appendChild(container);
            
            // Carregar dados salvos
            setTimeout(() => {
                carregarDadosCalendario();
            }, 100);
        }

        // ============================================================================
        // EXIBI√á√ÉO DO PERFIL - CORRIGIDA
        // ============================================================================
        function exibirPerfil() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>üë§ Meu Perfil</span>`;
            quizzesContainer.appendChild(title);
            
            const container = document.createElement('div');
            container.className = 'perfil-container';
            
            container.innerHTML = `
                <div style="text-align: center; margin-bottom: 30px;">
                    <div class="perfil-photo">
                        ${usuarioLogado.fotoBase64 ? 
                            `<img src="${usuarioLogado.fotoBase64}" alt="Foto do perfil">` : 
                            usuarioLogado.nome.charAt(0).toUpperCase()
                        }
                    </div>
                    <h2 style="color: #0af; margin: 0;">${usuarioLogado.nome} ${usuarioLogado.sobrenome || ''}</h2>
                    <p style="color: #666; margin: 5px 0;">@${usuarioLogado.usuario}</p>
                    <div style="display: inline-block; padding: 5px 15px; background: linear-gradient(45deg, #0af, #08c); color: #000; border-radius: 20px; font-weight: bold; text-transform: uppercase; margin-top: 10px;">
                        ${usuarioLogado.tipo}
                    </div>
                </div>
                
                <div class="perfil-info">
                    <div class="info-row">
                        <span class="info-label">üìß Email:</span>
                        <span class="info-value" id="emailValue">${usuarioLogado.email}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">üì± Telefone:</span>
                        <span class="info-value" id="telefoneValue">${usuarioLogado.telefone || usuarioLogado.celular || '-'}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">üÜî ID do Usu√°rio:</span>
                        <span class="info-value">${usuarioLogado.id}</span>
                    </div>
                    
                    <div class="info-row">
                        <span class="info-label">üìÖ Membro desde:</span>
                        <span class="info-value">${usuarioLogado.dataCadastro ? new Date(usuarioLogado.dataCadastro).toLocaleDateString('pt-BR') : 'N√£o informado'}</span>
                    </div>
                </div>
                
                <div style="margin-top: 30px; text-align: center;">
                    <button onclick="editarPerfil()" style="background: linear-gradient(45deg, #ffc107, #ffca2c); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-right: 10px;">
                        ‚úèÔ∏è Editar Perfil
                    </button>
                    <button onclick="alterarSenha()" style="background: linear-gradient(45deg, #17a2b8, #20c997); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        üîê Alterar Senha
                    </button>
                </div>
                
                <div style="margin-top: 20px; text-align: center; color: #666; font-size: 0.9rem;">
                    <p>Para altera√ß√µes sens√≠veis, ser√° necess√°rio confirmar sua senha atual.</p>
                </div>
            `;
            
            quizzesContainer.appendChild(container);
        }

        // ============================================================================
        // FUN√á√ïES DE CRIA√á√ÉO DE CARDS - CORRIGIDAS
        // ============================================================================
        function criarCardQuiz(quiz, status) {
            const card = document.createElement('div');
            card.className = 'quiz-card';

            if (quiz.imagem || quiz.imagemBase64) {
                const img = document.createElement('img');
                img.src = quiz.imagem || quiz.imagemBase64;
                img.alt = quiz.nome || quiz.titulo;
                img.className = 'quiz-image';
                card.appendChild(img);
            }

            const title = document.createElement('div');
            title.className = 'quiz-title';
            title.textContent = quiz.nome || quiz.titulo;
            card.appendChild(title);

            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#666';
            info.innerHTML = `
                <div>üìä Tamanho: ${pdf.tamanho || 'N/A'}</div>
                <div>üìÖ Upload: ${new Date(pdf.dataUpload || Date.now()).toLocaleDateString('pt-BR')}</div>
                <div>üéØ Status: ${status}</div>
            `;
            card.appendChild(info);

            // Bot√µes de a√ß√£o baseados no status
            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            
            if (status === 'ativo') {
                actions.innerHTML = `
                    <button class="action-btn btn-edit" onclick="downloadPDF('${pdf.id}')">üì• Download</button>
                    <button class="action-btn btn-archive" onclick="arquivarPDF('${pdf.id}')">üìÅ Arquivar</button>
                    <button class="action-btn btn-delete" onclick="excluirPDF('${pdf.id}')">üóëÔ∏è Excluir</button>
                `;
            } else if (status === 'arquivado') {
                actions.innerHTML = `
                    <button class="action-btn btn-approve" onclick="restaurarPDF('${pdf.id}')">‚Ü©Ô∏è Restaurar</button>
                    <button class="action-btn btn-delete" onclick="excluirPDF('${pdf.id}')">üóëÔ∏è Excluir</button>
                `;
            } else if (status === 'excluido') {
                actions.innerHTML = `
                    <button class="action-btn btn-approve" onclick="restaurarPDF('${pdf.id}')">‚Ü©Ô∏è Restaurar</button>
                    <button class="action-btn btn-delete" onclick="excluirPermanente('pdf', '${pdf.id}')">‚ùå Excluir Permanentemente</button>
                `;
            }
            
            card.appendChild(actions);
            return card;
        }

        // ============================================================================
        // FUN√á√ïES DE A√á√ÉO - CORRIGIDAS
        // ============================================================================

        // Upload de PDF
        async function handlePDFUpload(files) {
            if (!files || files.length === 0) return;
            
            updateDebug('Fazendo upload de PDFs...');
            mostrarMensagemSucesso('üì§ Fazendo upload dos arquivos...');
            
            const formData = new FormData();
            
            for (let file of files) {
                if (file.type !== 'application/pdf') {
                    mostrarMensagemSucesso(`‚ùå ${file.name} n√£o √© um arquivo PDF v√°lido!`);
                    continue;
                }
                
                if (file.size > 10 * 1024 * 1024) { // 10MB
                    mostrarMensagemSucesso(`‚ùå ${file.name} √© muito grande (m√°ximo 10MB)!`);
                    continue;
                }
                
                formData.append('pdfs', file);
            }
            
            try {
                const response = await fetch('https://brainquiz-backend.onrender.com/api/upload-pdf', {
                    method: 'POST',
                    credentials: 'include',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ PDFs enviados com sucesso!');
                    await carregarDadosBackend(); // Recarregar dados
                    if (currentTab === 'pdfs') {
                        exibirPDFs(); // Atualizar exibi√ß√£o
                    }
                } else {
                    mostrarMensagemSucesso('‚ùå Erro no upload: ' + result.message);
                }
                
            } catch (error) {
                console.error('Erro no upload:', error);
                mostrarMensagemSucesso('‚ùå Erro de conex√£o no upload!');
            }
            
            updateDebug('Upload finalizado');
        }

        // Jogar Quiz
        function jogarQuiz(quiz) {
            if (!quiz.perguntas || quiz.perguntas.length === 0) {
                alert('Este quiz ainda n√£o possui perguntas!');
                return;
            }
            
            const quizParaJogar = {
                id: quiz.id,
                nome: quiz.nome || quiz.titulo,
                imagem: quiz.imagem || quiz.imagemBase64,
                perguntas: quiz.perguntas,
                configuracoes: quiz.configuracoes || {}
            };
            
            localStorage.setItem('quizAtual', JSON.stringify(quizParaJogar));
            window.location.href = 'quiz.html';
        }

        // A√ß√µes de Quiz
        async function arquivarQuiz(quizId) {
            if (!confirm('Deseja arquivar este quiz?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/quiz/${quizId}/arquivar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Quiz arquivado com sucesso!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao arquivar quiz!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        async function excluirQuiz(quizId) {
            if (!confirm('Deseja mover este quiz para a lixeira?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/quiz/${quizId}/excluir`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Quiz movido para lixeira!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao excluir quiz!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        async function restaurarQuiz(quizId) {
            if (!confirm('Deseja restaurar este quiz?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/quiz/${quizId}/restaurar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Quiz restaurado com sucesso!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao restaurar quiz!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        // A√ß√µes de PDF
        async function downloadPDF(pdfId) {
            try {
                window.open(`https://brainquiz-backend.onrender.com/api/pdf/${pdfId}/download`, '_blank');
                mostrarMensagemSucesso('üì• Download iniciado!');
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro no download!');
            }
        }

        async function arquivarPDF(pdfId) {
            if (!confirm('Deseja arquivar este PDF?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdf/${pdfId}/arquivar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ PDF arquivado!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao arquivar PDF!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        async function excluirPDF(pdfId) {
            if (!confirm('Deseja mover este PDF para a lixeira?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdf/${pdfId}/excluir`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ PDF movido para lixeira!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao excluir PDF!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        async function restaurarPDF(pdfId) {
            if (!confirm('Deseja restaurar este PDF?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdf/${pdfId}/restaurar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ PDF restaurado!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao restaurar PDF!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        // Exclus√£o permanente
        async function excluirPermanente(tipo, itemId) {
            if (!confirm(`Deseja EXCLUIR PERMANENTEMENTE este ${tipo}? Esta a√ß√£o n√£o pode ser desfeita!`)) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/${tipo}/${itemId}/excluir-permanente`, {
                    method: 'DELETE',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso(`‚úÖ ${tipo} exclu√≠do permanentemente!`);
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso(`‚ùå Erro ao excluir ${tipo} permanentemente!`);
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        // A√ß√µes de Cadastro
        async function aprovarCadastro(cadastroId) {
            if (!confirm('Deseja aprovar este cadastro?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/cadastro/${cadastroId}/aprovar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Cadastro aprovado com sucesso!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao aprovar cadastro!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        async function rejeitarCadastro(cadastroId) {
            if (!confirm('Deseja rejeitar este cadastro?')) return;
            
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/cadastro/${cadastroId}/rejeitar`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Cadastro rejeitado!');
                    await carregarDadosBackend();
                    exibirConteudo();
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao rejeitar cadastro!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        // Fun√ß√µes do Calend√°rio
        function carregarDadosCalendario() {
            if (calendarioData) {
                document.getElementById('fase').value = calendarioData.fase || '';
                document.getElementById('periodo').value = calendarioData.periodo || '';
                document.getElementById('modulo').value = calendarioData.modulo || '';
                document.getElementById('semestre').value = calendarioData.semestre || '';
                document.getElementById('inicioSemestre').value = calendarioData.inicioSemestre || '';
                document.getElementById('fimSemestre').value = calendarioData.fimSemestre || '';
            }
        }

        async function salvarCalendario() {
            const dadosCalendario = {
                fase: document.getElementById('fase').value,
                periodo: document.getElementById('periodo').value,
                modulo: document.getElementById('modulo').value,
                semestre: document.getElementById('semestre').value,
                inicioSemestre: document.getElementById('inicioSemestre').value,
                fimSemestre: document.getElementById('fimSemestre').value
            };
            
            try {
                const response = await fetch('https://brainquiz-backend.onrender.com/api/calendario', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(dadosCalendario)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    calendarioData = dadosCalendario;
                    mostrarMensagemSucesso('‚úÖ Calend√°rio salvo com sucesso!');
                } else {
                    mostrarMensagemSucesso('‚ùå Erro ao salvar calend√°rio!');
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        // Fun√ß√µes do Perfil
        function editarPerfil() {
            const emailValue = document.getElementById('emailValue');
            const telefoneValue = document.getElementById('telefoneValue');
            
            emailValue.innerHTML = `<input type="email" class="edit-field" value="${usuarioLogado.email}" id="editEmail">`;
            telefoneValue.innerHTML = `<input type="tel" class="edit-field" value="${usuarioLogado.telefone || usuarioLogado.celular || ''}" id="editTelefone">`;
            
            const container = document.querySelector('.perfil-container');
            const buttonsDiv = container.querySelector('div[style*="margin-top: 30px"]');
            buttonsDiv.innerHTML = `
                <button onclick="salvarPerfil()" style="background: linear-gradient(45deg, #28a745, #20c997); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-right: 10px;">
                    üíæ Salvar Altera√ß√µes
                </button>
                <button onclick="cancelarEdicao()" style="background: linear-gradient(45deg, #dc3545, #c82333); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                    ‚ùå Cancelar
                </button>
                <p style="margin-top: 15px; color: #666; font-size: 0.9rem;">
                    <input type="password" placeholder="Confirme sua senha atual" id="senhaConfirmacao" style="background: rgba(34, 34, 34, 0.8); border: 1px solid rgba(0,170,255,0.3); border-radius: 5px; padding: 8px; color: #0af; width: 200px;">
                </p>
            `;
        }

        async function salvarPerfil() {
            const novoEmail = document.getElementById('editEmail').value;
            const novoTelefone = document.getElementById('editTelefone').value;
            const senhaConfirmacao = document.getElementById('senhaConfirmacao').value;
            
            if (!senhaConfirmacao) {
                alert('Digite sua senha atual para confirmar as altera√ß√µes!');
                return;
            }
            
            try {
                const response = await fetch('https://brainquiz-backend.onrender.com/api/perfil/atualizar', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        email: novoEmail,
                        telefone: novoTelefone,
                        senhaAtual: senhaConfirmacao
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    usuarioLogado.email = novoEmail;
                    usuarioLogado.telefone = novoTelefone;
                    localStorage.setItem('usuarioLogado', JSON.stringify(usuarioLogado));
                    
                    mostrarMensagemSucesso('‚úÖ Perfil atualizado com sucesso!');
                    exibirPerfil(); // Recarregar perfil
                } else {
                    mostrarMensagemSucesso('‚ùå Erro: ' + result.message);
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        function cancelarEdicao() {
            exibirPerfil(); // Recarregar perfil original
        }

        function alterarSenha() {
            const container = document.querySelector('.perfil-container');
            
            const senhaDiv = document.createElement('div');
            senhaDiv.style.marginTop = '20px';
            senhaDiv.style.padding = '20px';
            senhaDiv.style.background = 'rgba(34, 34, 34, 0.8)';
            senhaDiv.style.borderRadius = '10px';
            senhaDiv.innerHTML = `
                <h4 style="color: #0af; margin-bottom: 15px;">üîê Alterar Senha</h4>
                <div style="margin-bottom: 15px;">
                    <label style="color: #0af; display: block; margin-bottom: 5px;">Senha Atual:</label>
                    <input type="password" id="senhaAtual" class="edit-field" placeholder="Digite sua senha atual">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #0af; display: block; margin-bottom: 5px;">Nova Senha:</label>
                    <input type="password" id="novaSenha" class="edit-field" placeholder="Digite a nova senha (m√≠n. 6 caracteres)">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="color: #0af; display: block; margin-bottom: 5px;">Confirmar Nova Senha:</label>
                    <input type="password" id="confirmarNovaSenha" class="edit-field" placeholder="Confirme a nova senha">
                </div>
                <div style="text-align: center;">
                    <button onclick="confirmarAlteracaoSenha()" style="background: linear-gradient(45deg, #28a745, #20c997); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer; margin-right: 10px;">
                        üîê Alterar Senha
                    </button>
                    <button onclick="cancelarAlteracaoSenha()" style="background: linear-gradient(45deg, #dc3545, #c82333); color: #fff; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        ‚ùå Cancelar
                    </button>
                </div>
            `;
            
            container.appendChild(senhaDiv);
        }

        async function confirmarAlteracaoSenha() {
            const senhaAtual = document.getElementById('senhaAtual').value;
            const novaSenha = document.getElementById('novaSenha').value;
            const confirmarNovaSenha = document.getElementById('confirmarNovaSenha').value;
            
            if (!senhaAtual || !novaSenha || !confirmarNovaSenha) {
                alert('Preencha todos os campos!');
                return;
            }
            
            if (novaSenha.length < 6) {
                alert('A nova senha deve ter pelo menos 6 caracteres!');
                return;
            }
            
            if (novaSenha !== confirmarNovaSenha) {
                alert('As senhas n√£o coincidem!');
                return;
            }
            
            try {
                const response = await fetch('https://brainquiz-backend.onrender.com/api/perfil/alterar-senha', {
                    method: 'POST',
                    credentials: 'include',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        senhaAtual: senhaAtual,
                        novaSenha: novaSenha
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    mostrarMensagemSucesso('‚úÖ Senha alterada com sucesso!');
                    exibirPerfil(); // Recarregar perfil
                } else {
                    mostrarMensagemSucesso('‚ùå Erro: ' + result.message);
                }
            } catch (error) {
                mostrarMensagemSucesso('‚ùå Erro de conex√£o!');
            }
        }

        function cancelarAlteracaoSenha() {
            exibirPerfil(); // Recarregar perfil original
        }

        // ============================================================================
        // INICIALIZA√á√ÉO PRINCIPAL - CORRIGIDA
        // ============================================================================
        (async () => {
            try {
                console.log('üöÄ Iniciando Dashboard BrainQuiz v4.0...');
                updateDebug('Inicializando sistema...');
                
                mostrarLoading('Verificando autentica√ß√£o...');
                
                // Verificar usu√°rio logado
                const usuarioValido = await verificarUsuarioLogado();
                if (!usuarioValido) {
                    return; // J√° foi redirecionado para login
                }
                
                mostrarLoading('Carregando dados do sistema...');
                await carregarDadosBackend();
                
                mostrarLoading('Configurando interface...');
                configurarBotoesPrincipais();
                configurarTabs();
                
                // Exibir conte√∫do inicial
                exibirConteudo();
                
                console.log('‚úÖ Sistema inicializado com sucesso!');
                console.log('üë§ Usu√°rio:', usuarioLogado.usuario, '(' + usuarioLogado.tipo + ')');
                updateDebug(`Sistema pronto - ${usuarioLogado.nome}`);
                
                mostrarMensagemSucesso(`‚ú® Bem-vindo, ${usuarioLogado.nome}! Dashboard carregado.`);
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
                updateDebug(`Erro: ${error.message}`);
                
                quizzesContainer.innerHTML = `
                    <div class="error">
                        <h3>‚ùå Erro na Inicializa√ß√£o</h3>
                        <p>Erro: ${error.message}</p>
                        <p>Tente recarregar a p√°gina ou entre em contato com o suporte.</p>
                        <button onclick="window.location.reload()" style="background: linear-gradient(45deg, #0af, #08c); color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            üîÑ Recarregar P√°gina
                        </button>
                    </div>
                `;
            }
        })();

        // Iniciar anima√ß√£o de part√≠culas
        document.addEventListener('DOMContentLoaded', () => {
            criarParticulas();
        });

        console.log('üéØ DASHBOARD COMPLETAMENTE CORRIGIDO!');
        console.log('üîß PRINCIPAIS CORRE√á√ïES APLICADAS:');
        console.log('   ‚úÖ 1. Bot√£o de upload de PDF na aba PDFs');
        console.log('   ‚úÖ 2. Lixeira mostra PDFs e Quizzes exclu√≠dos');
        console.log('   ‚úÖ 3. Usu√°rios ativos sendo exibidos corretamente');
        console.log('   ‚úÖ 4. Aba arquivados mostra quizzes e PDFs arquivados');
        console.log('   ‚úÖ 5. Aba exclu√≠dos renomeada para lixeira e funcionando');
        console.log('   ‚úÖ 6. Cadastros pendentes sendo exibidos do backend');
        console.log('   ‚úÖ 7. Calend√°rio acad√™mico com campos salvos');
        console.log('   ‚úÖ 8. Perfil edit√°vel com confirma√ß√£o de senha');
        console.log('   ‚úÖ 9. Quizzes ativos sendo carregados e exibidos');
        console.log('üîó Backend: https://brainquiz-backend.onrender.com');

    </script>
</body>
</html>
            info.innerHTML = `
                <div>üìä ${quiz.perguntas?.length || 0} perguntas</div>
                <div>üìÖ Criado: ${new Date(quiz.dataCriacao || Date.now()).toLocaleDateString('pt-BR')}</div>
                <div>üéØ Status: ${status}</div>
            `;
            card.appendChild(info);

            // Bot√µes de a√ß√£o baseados no status
            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            
            if (status === 'ativo') {
                actions.innerHTML = `
                    <button class="action-btn btn-edit" onclick="editarQuiz('${quiz.id}')">‚úèÔ∏è Editar</button>
                    <button class="action-btn btn-archive" onclick="arquivarQuiz('${quiz.id}')">üìÅ Arquivar</button>
                    <button class="action-btn btn-delete" onclick="excluirQuiz('${quiz.id}')">üóëÔ∏è Excluir</button>
                `;
                
                card.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON') {
                        jogarQuiz(quiz);
                    }
                };
            } else if (status === 'arquivado') {
                actions.innerHTML = `
                    <button class="action-btn btn-approve" onclick="restaurarQuiz('${quiz.id}')">‚Ü©Ô∏è Restaurar</button>
                    <button class="action-btn btn-delete" onclick="excluirQuiz('${quiz.id}')">üóëÔ∏è Excluir</button>
                `;
            } else if (status === 'excluido') {
                actions.innerHTML = `
                    <button class="action-btn btn-approve" onclick="restaurarQuiz('${quiz.id}')">‚Ü©Ô∏è Restaurar</button>
                    <button class="action-btn btn-delete" onclick="excluirPermanente('quiz', '${quiz.id}')">‚ùå Excluir Permanentemente</button>
                `;
            }
            
            card.appendChild(actions);
            return card;
        }

        function criarCardUsuario(user) {
            const card = document.createElement('div');
            card.className = 'user-card';

            const badge = document.createElement('div');
            badge.className = `user-badge badge-${user.tipo}`;
            badge.textContent = user.tipo;
            card.appendChild(badge);

            const photo = document.createElement('div');
            photo.className = 'user-photo';
            
            if (user.fotoBase64) {
                const img = document.createElement('img');
                img.src = user.fotoBase64;
                img.alt = user.nome;
                photo.appendChild(img);
            } else {
                photo.textContent = user.nome.charAt(0).toUpperCase();
            }
            card.appendChild(photo);

            const title = document.createElement('div');
            title.className = 'user-title';
            title.textContent = `${user.nome} ${user.sobrenome || ''}`;
            card.appendChild(title);

            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#0af';
            info.style.textAlign = 'center';
            info.innerHTML = `
                <div><b>Usu√°rio:</b> ${user.usuario}</div>
                <div><b>Email:</b> ${user.email}</div>
                <div><b>Telefone:</b> ${user.telefone || user.celular || '-'}</div>
                <div><b>Status:</b> ${user.ativo ? '‚úÖ Ativo' : '‚ùå Inativo'}</div>
            `;
            card.appendChild(info);

            // Bot√µes de a√ß√£o para administradores
            if (usuarioLogado.tipo === 'administrador' && user.id !== usuarioLogado.id) {
                const actions = document.createElement('div');
                actions.className = 'action-buttons';
                actions.innerHTML = `
                    <button class="action-btn btn-edit" onclick="editarUsuario('${user.id}')">‚úèÔ∏è Editar</button>
                    <button class="action-btn btn-delete" onclick="desativarUsuario('${user.id}')">üö´ Desativar</button>
                `;
                card.appendChild(actions);
            }

            return card;
        }

        function criarCardCadastroPendente(cadastro) {
            const card = document.createElement('div');
            card.className = 'user-card';
            card.style.border = '2px solid #ffc107';
            
            const photo = document.createElement('div');
            photo.className = 'user-photo';
            photo.style.width = '60px';
            photo.style.height = '60px';
            photo.style.fontSize = '1.5rem';
            
            if (cadastro.fotoBase64) {
                const img = document.createElement('img');
                img.src = cadastro.fotoBase64;
                img.alt = cadastro.nome;
                photo.appendChild(img);
            } else {
                photo.textContent = cadastro.nome.charAt(0).toUpperCase();
            }
            card.appendChild(photo);
            
            const title = document.createElement('div');
            title.className = 'user-title';
            title.textContent = `${cadastro.nome} ${cadastro.sobrenome || ''} (${cadastro.usuario})`;
            card.appendChild(title);
            
            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#0af';
            info.style.textAlign = 'center';
            info.innerHTML = `
                <div><b>Email:</b> ${cadastro.email}</div>
                <div><b>Telefone:</b> ${cadastro.telefone || cadastro.celular || '-'}</div>
                <div><b>Tipo Solicitado:</b> ${cadastro.tipoSolicitado || 'aluno'}</div>
                <div style="color: #ffa726; margin-top: 10px;"><b>‚è≥ AGUARDANDO APROVA√á√ÉO</b></div>
            `;
            card.appendChild(info);
            
            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            actions.innerHTML = `
                <button class="action-btn btn-approve" onclick="aprovarCadastro('${cadastro.id}')">‚úÖ Aprovar</button>
                <button class="action-btn btn-reject" onclick="rejeitarCadastro('${cadastro.id}')">‚ùå Rejeitar</button>
            `;
            card.appendChild(actions);
            
            return card;
        }

        function criarCardPDF(pdf, status) {
            const card = document.createElement('div');
            card.className = 'pdf-card';

            const icon = document.createElement('div');
            icon.style.fontSize = '4rem';
            icon.style.textAlign = 'center';
            icon.style.marginBottom = '15px';
            icon.textContent = 'üìÑ';
            card.appendChild(icon);

            const title = document.createElement('div');
            title.className = 'pdf-card-name';
            title.textContent = pdf.nome || pdf.filename || 'Documento PDF';
            card.appendChild(title);

            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#666';================================================================
        // VARI√ÅVEIS GLOBAIS
        // ============================================================================
        let usuarioLogado = null;
        let users = [];
        let cadastrosPendentes = [];
        let quizzesAtivos = [];
        let quizzesArquivados = [];
        let quizzesExcluidos = [];
        let pdfsAtivos = [];
        let pdfsArquivados = [];
        let pdfsExcluidos = [];
        let calendarioData = {};
        let currentTab = 'ativos';

        // ============================================================================
        // ELEMENTOS DOM
        // ============================================================================
        const quizzesContainer = document.getElementById('quizzesContainer');
        const createQuizBtn = document.getElementById('createQuizBtn');
        const exitBtn = document.getElementById('exitBtn');
        const mensagemSucesso = document.getElementById('mensagemSucesso');
        const debugInfo = document.getElementById('debugInfo');
        const userInfo = document.getElementById('userInfo');

        // ============================================================================
        // FUN√á√ïES AUXILIARES
        // ============================================================================
        function updateDebug(message) {
            debugInfo.innerHTML = `üîß ${message}`;
            console.log('üîß DEBUG:', message);
        }

        function updateUserInfo(user) {
            if (user) {
                userInfo.innerHTML = `üë§ ${user.nome} (${user.tipo})`;
                userInfo.style.display = 'block';
            } else {
                userInfo.style.display = 'none';
            }
        }

        function criarParticulas() {
            const container = document.querySelector('.particles');
            
            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 8000);
            }, 500);
        }

        function mostrarMensagemSucesso(mensagem) {
            mensagemSucesso.textContent = mensagem;
            mensagemSucesso.classList.add('show');
            
            setTimeout(() => {
                mensagemSucesso.classList.remove('show');
            }, 4000);
        }

        function mostrarLoading(mensagem = 'Carregando...') {
            quizzesContainer.innerHTML = `<div class="loading">${mensagem}</div>`;
        }

        // ============================================================================
        // VERIFICA√á√ÉO DE USU√ÅRIO LOGADO - CORRIGIDA
        // ============================================================================
        async function verificarUsuarioLogado() {
            console.log('üîç Verificando usu√°rio logado...');
            updateDebug('Verificando autentica√ß√£o...');
            
            try {
                // Verificar sess√£o do backend
                const response = await fetch('https://brainquiz-backend.onrender.com/api/me', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.usuario) {
                        usuarioLogado = result.usuario;
                        console.log('‚úÖ Usu√°rio autenticado pelo backend:', usuarioLogado);
                        updateUserInfo(usuarioLogado);
                        return true;
                    }
                }
            } catch (error) {
                console.log('‚ö†Ô∏è Erro na verifica√ß√£o backend:', error.message);
            }

            // Fallback: verificar localStorage
            const usuarioLocal = localStorage.getItem('usuarioLogado');
            if (usuarioLocal) {
                try {
                    const userData = JSON.parse(usuarioLocal);
                    if (userData.usuario && userData.nome) {
                        usuarioLogado = userData;
                        console.log('‚úÖ Usu√°rio carregado do localStorage:', usuarioLogado);
                        updateUserInfo(usuarioLogado);
                        return true;
                    }
                } catch (e) {
                    console.error('‚ùå Erro ao parsear localStorage:', e);
                }
            }

            // Se n√£o h√° usu√°rio logado, redirecionar para login
            console.log('‚ùå Nenhum usu√°rio logado encontrado');
            window.location.href = 'index.html';
            return false;
        }

        // ============================================================================
        // CARREGAMENTO DE DADOS DO BACKEND - CORRIGIDO
        // ============================================================================
        async function carregarDadosBackend() {
            console.log('üì° Carregando dados do backend...');
            updateDebug('Carregando dados do sistema...');
            
            const baseURL = 'https://brainquiz-backend.onrender.com/api';
            
            try {
                // 1. Carregar usu√°rios ativos
                try {
                    const usuariosResponse = await fetch(`${baseURL}/usuarios`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (usuariosResponse.ok) {
                        const usuariosData = await usuariosResponse.json();
                        users = usuariosData.usuarios || usuariosData.data || [];
                        console.log('‚úÖ Usu√°rios carregados:', users.length);
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao carregar usu√°rios:', e.message);
                    users = [];
                }

                // 2. Carregar cadastros pendentes
                try {
                    const cadastrosResponse = await fetch(`${baseURL}/cadastros-pendentes`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (cadastrosResponse.ok) {
                        const cadastrosData = await cadastrosResponse.json();
                        cadastrosPendentes = cadastrosData.cadastros || cadastrosData.data || [];
                        console.log('‚úÖ Cadastros pendentes carregados:', cadastrosPendentes.length);
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao carregar cadastros:', e.message);
                    cadastrosPendentes = [];
                }

                // 3. Carregar quizzes ativos
                try {
                    const quizzesResponse = await fetch(`${baseURL}/quizzes`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (quizzesResponse.ok) {
                        const quizzesData = await quizzesResponse.json();
                        const todosQuizzes = quizzesData.quizzes || quizzesData.data || [];
                        
                        // Separar por status
                        quizzesAtivos = todosQuizzes.filter(q => q.status === 'ativo' || !q.status);
                        quizzesArquivados = todosQuizzes.filter(q => q.status === 'arquivado');
                        quizzesExcluidos = todosQuizzes.filter(q => q.status === 'excluido');
                        
                        console.log('‚úÖ Quizzes carregados - Ativos:', quizzesAtivos.length, 'Arquivados:', quizzesArquivados.length, 'Exclu√≠dos:', quizzesExcluidos.length);
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao carregar quizzes:', e.message);
                    quizzesAtivos = [];
                    quizzesArquivados = [];
                    quizzesExcluidos = [];
                }

                // 4. Carregar PDFs
                try {
                    const pdfsResponse = await fetch(`${baseURL}/pdfs`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (pdfsResponse.ok) {
                        const pdfsData = await pdfsResponse.json();
                        const todosPdfs = pdfsData.pdfs || pdfsData.data || [];
                        
                        // Separar por status
                        pdfsAtivos = todosPdfs.filter(p => p.status === 'ativo' || !p.status);
                        pdfsArquivados = todosPdfs.filter(p => p.status === 'arquivado');
                        pdfsExcluidos = todosPdfs.filter(p => p.status === 'excluido');
                        
                        console.log('‚úÖ PDFs carregados - Ativos:', pdfsAtivos.length, 'Arquivados:', pdfsArquivados.length, 'Exclu√≠dos:', pdfsExcluidos.length);
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao carregar PDFs:', e.message);
                    pdfsAtivos = [];
                    pdfsArquivados = [];
                    pdfsExcluidos = [];
                }

                // 5. Carregar dados do calend√°rio
                try {
                    const calendarioResponse = await fetch(`${baseURL}/calendario`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (calendarioResponse.ok) {
                        const calendarioResult = await calendarioResponse.json();
                        calendarioData = calendarioResult.calendario || calendarioResult.data || {};
                        console.log('‚úÖ Calend√°rio carregado:', Object.keys(calendarioData).length, 'entradas');
                    }
                } catch (e) {
                    console.log('‚ö†Ô∏è Erro ao carregar calend√°rio:', e.message);
                    calendarioData = {};
                }

                updateDebug('Dados carregados com sucesso');
                
            } catch (error) {
                console.error('‚ùå Erro geral no carregamento:', error);
                updateDebug(`Erro: ${error.message}`);
                mostrarMensagemSucesso('‚ö†Ô∏è Alguns dados podem n√£o estar atualizados');
            }
        }

        // ============

<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Painel Inicial - BrainQuiz</title>
    <style>
        body {
            background: linear-gradient(135deg, #000 0%, #1a1a2e 50%, #16213e 100%);
            color: #0af;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden;
        }

        .particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }
        
        .particle {
            position: absolute;
            width: 2px;
            height: 2px;
            background: #0af;
            border-radius: 50%;
            animation: float 8s infinite linear;
            box-shadow: 0 0 10px #0af;
        }
        
        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) translateX(100px);
                opacity: 0;
            }
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto 20px;
            background: rgba(17, 17, 17, 0.8);
            padding: 20px 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(0, 170, 255, 0.3);
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.2);
        }
        
        h1 {
            margin: 0;
            text-shadow: 0 0 20px #0af;
            font-size: 2.5rem;
            animation: pulse 3s infinite;
        }

        @keyframes pulse {
            0%, 100% { text-shadow: 0 0 20px #0af; }
            50% { text-shadow: 0 0 40px #0af, 0 0 60px #0af; }
        }
        
        .header-buttons {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        #createQuizBtn, #exitBtn {
            background: linear-gradient(45deg, #0af, #08c);
            border: none;
            border-radius: 10px;
            padding: 12px 24px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.3);
            transition: all 0.3s ease;
            display: inline-block;
        }
        
        #createQuizBtn:hover, #exitBtn:hover {
            background: linear-gradient(45deg, #08c, #0af);
            color: #fff;
            box-shadow: 0 8px 30px rgba(0, 170, 255, 0.6);
            transform: translateY(-3px);
        }
        
        #exitBtn {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            box-shadow: 0 5px 20px rgba(255, 68, 68, 0.3);
        }
        
        #exitBtn:hover {
            background: linear-gradient(45deg, #cc0000, #ff4444);
            box-shadow: 0 8px 30px rgba(255, 68, 68, 0.6);
        }
        
        #tabs {
            max-width: 1200px;
            margin: 0 auto 20px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
            background: rgba(17, 17, 17, 0.6);
            padding: 15px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 170, 255, 0.2);
        }
        
        .tab-button {
            background: rgba(34, 34, 34, 0.8);
            border: none;
            border-radius: 10px;
            padding: 12px 20px;
            color: #0af;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0, 170, 255, 0.2);
            font-weight: bold;
            transition: all 0.3s ease;
            flex-shrink: 0;
        }
        
        .tab-button.active, .tab-button:hover {
            background: linear-gradient(45deg, #0af, #08c);
            color: #000;
            box-shadow: 0 8px 25px rgba(0, 170, 255, 0.4);
            transform: translateY(-2px);
        }
        
        #quizzesContainer {
            max-width: 1200px;
            margin: 0 auto;
            min-height: 200px;
        }
        
        .section-title {
            color: #0af;
            font-size: 1.8rem;
            margin: 0 0 20px 0;
            text-shadow: 0 0 15px #0af;
            border-bottom: 3px solid #0af;
            padding: 15px;
            text-align: center;
            background: linear-gradient(90deg, transparent, rgba(0,170,255,0.1), transparent);
            border-radius: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(0, 170, 255, 0.3);
        }
        
        .items-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }
        
        .quiz-card, .user-card, .pdf-card {
            background: rgba(17, 17, 17, 0.9);
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,170,255,0.2);
            padding: 20px;
            width: 280px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,170,255,0.3);
            backdrop-filter: blur(10px);
        }
        
        .quiz-card:hover, .user-card:hover, .pdf-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 35px rgba(0,170,255,0.4);
            border-color: #0af;
        }
        
        .quiz-title, .user-title, .pdf-card-name {
            font-weight: bold;
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: #0af;
            text-shadow: 0 0 5px rgba(0,170,255,0.5);
        }
        
        .quiz-image {
            width: 100%;
            height: 150px;
            object-fit: cover;
            border-radius: 10px;
            margin-bottom: 15px;
            border: 2px solid rgba(0,170,255,0.3);
        }
        
        .user-photo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(45deg, #0af, #08c);
            color: #000;
            font-weight: bold;
            font-size: 2rem;
            overflow: hidden;
            border: 3px solid rgba(0,170,255,0.5);
        }
        
        .user-photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .user-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-administrador {
            background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
            color: #000;
        }
        
        .badge-moderador {
            background: linear-gradient(45deg, #ffa726, #ffcc02);
            color: #000;
        }
        
        .badge-aluno {
            background: linear-gradient(45deg, #66bb6a, #81c784);
            color: #000;
        }
        
        .empty-message {
            font-style: italic;
            color: #666;
            width: 100%;
            text-align: center;
            margin-top: 40px;
            padding: 40px;
            background: rgba(0,170,255,0.05);
            border-radius: 15px;
            border: 2px dashed rgba(0,170,255,0.2);
            backdrop-filter: blur(5px);
        }
        
        .loading {
            text-align: center;
            color: #0af;
            font-style: italic;
            padding: 40px;
            animation: pulse 2s infinite;
        }
        
        .error {
            color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            border: 1px solid rgba(255, 68, 68, 0.3);
            backdrop-filter: blur(5px);
        }
        
        #mensagemSucesso {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #0af, #08c);
            color: #000;
            padding: 15px 25px;
            border-radius: 10px;
            font-weight: bold;
            box-shadow: 0 8px 25px rgba(0,170,255,0.4);
            z-index: 1000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        #mensagemSucesso.show {
            opacity: 1;
            transform: translateX(0);
        }

        .user-info {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(0, 170, 255, 0.2);
            color: #0af;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .debug-info {
            position: fixed;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.9);
            color: #0af;
            padding: 10px;
            border-radius: 5px;
            font-size: 0.8rem;
            z-index: 1000;
            max-width: 300px;
            border: 1px solid rgba(0, 170, 255, 0.3);
        }

        .upload-area {
            border: 2px dashed rgba(0,170,255,0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(0,170,255,0.05);
        }

        .upload-area:hover {
            border-color: #0af;
            background: rgba(0,170,255,0.1);
        }

        .upload-area.dragover {
            border-color: #0af;
            background: rgba(0,170,255,0.2);
            transform: scale(1.02);
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .btn-view {
            background: linear-gradient(45deg, #17a2b8, #20c997);
            color: #fff;
        }

        .btn-download {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: #fff;
        }

        .btn-download.disabled {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: #666;
            cursor: not-allowed;
        }

        .btn-unlock {
            background: linear-gradient(45deg, #ffc107, #ffca2c);
            color: #000;
        }

        .btn-lock {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: #fff;
        }

        .btn-edit {
            background: linear-gradient(45deg, #ffc107, #ffca2c);
            color: #000;
        }

        .btn-archive {
            background: linear-gradient(45deg, #6c757d, #5a6268);
            color: #fff;
        }

        .btn-delete {
            background: linear-gradient(45deg, #dc3545, #c82333);
            color: #fff;
        }

        .action-btn:hover:not(.disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }

        .pdf-status {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: bold;
        }

        .status-bloqueado {
            background: linear-gradient(45deg, #ff4444, #cc0000);
            color: #fff;
        }

        .status-desbloqueado {
            background: linear-gradient(45deg, #4caf50, #45a049);
            color: #fff;
        }

        .pdf-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .pdf-viewer iframe {
            width: 90%;
            height: 90%;
            border: 2px solid #0af;
            border-radius: 10px;
        }

        .pdf-viewer-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: linear-gradient(45deg, #ff4444, #cc0000);
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            z-index: 2001;
        }

        /* Calendário Acadêmico Estilizado */
        .calendario-container {
            background: rgba(17, 17, 17, 0.9);
            border-radius: 20px;
            padding: 40px;
            margin: 20px auto;
            border: 2px solid rgba(0, 170, 255, 0.3);
            box-shadow: 0 10px 40px rgba(0, 170, 255, 0.2);
            backdrop-filter: blur(15px);
        }

        .calendario-header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, rgba(0, 170, 255, 0.1), rgba(0, 170, 255, 0.05));
            border-radius: 15px;
            border: 1px solid rgba(0, 170, 255, 0.2);
        }

        .status-atual {
            background: linear-gradient(135deg, #0af, #08c);
            color: #000;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.3);
        }

        .cronograma-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .periodo-card {
            background: rgba(34, 34, 34, 0.8);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(0, 170, 255, 0.2);
            transition: all 0.3s ease;
        }

        .periodo-card:hover {
            border-color: #0af;
            box-shadow: 0 5px 20px rgba(0, 170, 255, 0.3);
            transform: translateY(-5px);
        }

        .periodo-card.ativo {
            border-color: #0af;
            background: rgba(0, 170, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 170, 255, 0.3);
        }

        .periodo-titulo {
            color: #0af;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
            text-shadow: 0 0 10px rgba(0, 170, 255, 0.5);
        }

        .periodo-datas {
            color: #fff;
            margin-bottom: 10px;
        }

        .periodo-info {
            color: #ccc;
            font-size: 0.9rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0af, #08c);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .countdown-container {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .countdown-time {
            font-size: 1.5rem;
            font-weight: bold;
            color: #ffc107;
            text-shadow: 0 0 10px rgba(255, 193, 7, 0.5);
        }
        
        @media (max-width: 768px) {
            .items-grid {
                justify-content: center;
            }
            
            .quiz-card, .user-card, .pdf-card {
                width: 90%;
                max-width: 350px;
            }
            
            #tabs {
                justify-content: center;
            }
            
            .section-title {
                flex-direction: column;
                gap: 15px;
            }

            header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .header-buttons {
                justify-content: center;
            }

            .action-buttons {
                flex-direction: column;
                gap: 8px;
            }

            .pdf-viewer iframe {
                width: 95%;
                height: 85%;
            }

            .cronograma-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="particles"></div>
    
    <div class="debug-info" id="debugInfo">
        🔧 Status: Inicializando...
    </div>
    
    <div class="user-info" id="userInfo">
        👤 Carregando...
    </div>
    
    <header>
        <h1>🧠 BrainQuiz - Painel</h1>
        <div class="header-buttons">
            <button id="createQuizBtn" title="Criar novo quiz">📝 Criar Quiz</button>
            <button id="exitBtn" title="Sair do sistema">🚪 Sair</button>
        </div>
    </header>
    
    <div id="tabs">
        <button class="tab-button active" data-tab="ativos">🎯 Quizzes Ativos</button>
        <button class="tab-button" data-tab="arquivados" style="display: none;">📁 Arquivados</button>
        <button class="tab-button" data-tab="lixeira" style="display: none;">🗑️ Lixeira</button>
        <button class="tab-button" data-tab="usuarios" style="display: none;">👥 Usuários</button>
        <button class="tab-button" data-tab="cadastros" style="display: none;">⏳ Cadastros Pendentes</button>
        <button class="tab-button" data-tab="pdfs">📄 PDFs</button>
        <button class="tab-button" data-tab="calendario">📅 Calendário</button>
        <button class="tab-button" data-tab="perfil">👤 Meu Perfil</button>
    </div>

    <main id="mainContainer">
        <div id="quizzesContainer"></div>
    </main>

    <div id="mensagemSucesso"></div>

    <div class="pdf-viewer" id="pdfViewer">
        <button class="pdf-viewer-close" onclick="fecharVisualizadorPDF()">❌ Fechar</button>
        <iframe id="pdfFrame" src=""></iframe>
    </div>

    <script>
        // ============================================================================
        // VARIÁVEIS GLOBAIS
        // ============================================================================
        let usuarioLogado = null;
        let users = [];
        let cadastrosPendentes = [];
        let quizzesAtivos = [];
        let quizzesArquivados = [];
        let quizzesExcluidos = [];
        let pdfsAtivos = [];
        let pdfsArquivados = [];
        let pdfsExcluidos = [];
        let currentTab = 'ativos';

        // Dados do calendário acadêmico
        const calendarioAcademico = {
            "2025": {
                "1": {
                    "periodo": "PRIMEIRO PERÍODO",
                    "inicio": "2025-02-03",
                    "fim": "2025-05-16",
                    "semanas": 15,
                    "detalhes": [
                        "Início das aulas: 03/02/2025",
                        "Feriados: Carnaval (03-04/03), Tiradentes (21/04)",
                        "Avaliações intermediárias: 24/03 a 28/03",
                        "Avaliações finais: 05/05 a 09/05",
                        "Recuperação: 12/05 a 16/05"
                    ]
                },
                "2": {
                    "periodo": "SEGUNDO PERÍODO", 
                    "inicio": "2025-05-26",
                    "fim": "2025-08-29",
                    "semanas": 15,
                    "detalhes": [
                        "Início das aulas: 26/05/2025",
                        "Recesso: 14/07 a 01/08 (Férias de inverno)",
                        "Avaliações intermediárias: 30/06 a 04/07",
                        "Avaliações finais: 18/08 a 22/08",
                        "Recuperação: 25/08 a 29/08"
                    ]
                },
                "3": {
                    "periodo": "TERCEIRO PERÍODO",
                    "inicio": "2025-09-08",
                    "fim": "2025-12-19",
                    "semanas": 15,
                    "detalhes": [
                        "Início das aulas: 08/09/2025",
                        "Feriados: Independência (07/09), N. Sra. Aparecida (12/10), Finados (02/11), Proclamação da República (15/11)",
                        "Avaliações intermediárias: 13/10 a 17/10",
                        "Avaliações finais: 01/12 a 05/12",
                        "Recuperação: 08/12 a 12/12",
                        "Formatura: 19/12/2025"
                    ]
                }
            }
        };

        // ============================================================================
        // ELEMENTOS DOM
        // ============================================================================
        const quizzesContainer = document.getElementById('quizzesContainer');
        const createQuizBtn = document.getElementById('createQuizBtn');
        const exitBtn = document.getElementById('exitBtn');
        const mensagemSucesso = document.getElementById('mensagemSucesso');
        const debugInfo = document.getElementById('debugInfo');
        const userInfo = document.getElementById('userInfo');

        // ============================================================================
        // FUNÇÕES AUXILIARES
        // ============================================================================
        function updateDebug(message) {
            debugInfo.innerHTML = `🔧 ${message}`;
            console.log('🔧 DEBUG:', message);
        }

        function updateUserInfo(user) {
            if (user) {
                userInfo.innerHTML = `👤 ${user.nome} (${user.tipo})`;
                userInfo.style.display = 'block';
            } else {
                userInfo.style.display = 'none';
            }
        }

        function criarParticulas() {
            const container = document.querySelector('.particles');
            
            setInterval(() => {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(particle);
                
                setTimeout(() => {
                    if (particle.parentNode) {
                        particle.parentNode.removeChild(particle);
                    }
                }, 8000);
            }, 500);
        }

        function mostrarMensagemSucesso(mensagem) {
            mensagemSucesso.textContent = mensagem;
            mensagemSucesso.classList.add('show');
            
            setTimeout(() => {
                mensagemSucesso.classList.remove('show');
            }, 4000);
        }

        function mostrarLoading(mensagem = 'Carregando...') {
            quizzesContainer.innerHTML = `<div class="loading">${mensagem}</div>`;
        }

        // ============================================================================
        // CONFIGURAÇÃO DE BOTÕES E NAVEGAÇÃO
        // ============================================================================
        function configurarBotoesPrincipais() {
            createQuizBtn.onclick = () => {
                window.location.href = 'painel.html';
            };

            exitBtn.onclick = async () => {
                if (confirm('Deseja realmente sair do sistema?')) {
                    try {
                        await fetch('https://brainquiz-backend.onrender.com/api/logout', {
                            method: 'POST',
                            credentials: 'include'
                        });
                    } catch (error) {
                        console.log('⚠️ Erro no logout backend:', error);
                    }
                    
                    localStorage.clear();
                    window.location.href = 'index.html';
                }
            };
        }

        function configurarTabs() {
            const tabs = document.querySelectorAll('.tab-button');
            
            // Configurar visibilidade das abas baseado no tipo de usuário
            if (usuarioLogado.tipo === 'aluno') {
                document.querySelector('[data-tab="usuarios"]').style.display = 'none';
                document.querySelector('[data-tab="cadastros"]').style.display = 'none';
                document.querySelector('[data-tab="arquivados"]').style.display = 'none';
                document.querySelector('[data-tab="lixeira"]').style.display = 'none';
                createQuizBtn.style.display = 'none';
            } else if (usuarioLogado.tipo === 'moderador') {
                document.querySelector('[data-tab="usuarios"]').style.display = 'block';
                document.querySelector('[data-tab="cadastros"]').style.display = 'block';
                document.querySelector('[data-tab="arquivados"]').style.display = 'none';
                document.querySelector('[data-tab="lixeira"]').style.display = 'none';
            } else if (usuarioLogado.tipo === 'administrador') {
                document.querySelector('[data-tab="usuarios"]').style.display = 'block';
                document.querySelector('[data-tab="cadastros"]').style.display = 'block';
                document.querySelector('[data-tab="arquivados"]').style.display = 'block';
                document.querySelector('[data-tab="lixeira"]').style.display = 'block';
            }

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const tabName = tab.getAttribute('data-tab');
                    
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    currentTab = tabName;
                    exibirConteudo();
                });
            });
        }

        // ============================================================================
        // VERIFICAÇÃO DE USUÁRIO LOGADO
        // ============================================================================
        async function verificarUsuarioLogado() {
            updateDebug('Verificando autenticação...');
            
            try {
                const response = await fetch('https://brainquiz-backend.onrender.com/api/me', {
                    method: 'GET',
                    credentials: 'include',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });

                if (response.ok) {
                    const result = await response.json();
                    if (result.success && result.usuario) {
                        usuarioLogado = result.usuario;
                        updateUserInfo(usuarioLogado);
                        return true;
                    }
                }
            } catch (error) {
                console.log('⚠️ Erro na verificação backend:', error.message);
            }

            const usuarioLocal = localStorage.getItem('usuarioLogado');
            if (usuarioLocal) {
                try {
                    const userData = JSON.parse(usuarioLocal);
                    if (userData.usuario && userData.nome) {
                        usuarioLogado = userData;
                        updateUserInfo(usuarioLogado);
                        return true;
                    }
                } catch (e) {
                    console.error('❌ Erro ao parsear localStorage:', e);
                }
            }

            window.location.href = 'index.html';
            return false;
        }

        // ============================================================================
        // CARREGAMENTO DE DADOS DO BACKEND
        // ============================================================================
        async function carregarDadosBackend() {
            updateDebug('Carregando dados do sistema...');
            
            const baseURL = 'https://brainquiz-backend.onrender.com/api';
            
            try {
                // Carregar dados baseado no tipo de usuário
                if (usuarioLogado.tipo !== 'aluno') {
                    try {
                        const usuariosResponse = await fetch(`${baseURL}/usuarios`, {
                            method: 'GET',
                            credentials: 'include'
                        });
                        
                        if (usuariosResponse.ok) {
                            const usuariosData = await usuariosResponse.json();
                            users = usuariosData.usuarios || usuariosData.data || [];
                        }
                    } catch (e) {
                        users = [];
                    }
                }

                if (usuarioLogado.tipo === 'administrador' || usuarioLogado.tipo === 'moderador') {
                    try {
                        const cadastrosResponse = await fetch(`${baseURL}/cadastros-pendentes`, {
                            method: 'GET',
                            credentials: 'include'
                        });
                        
                        if (cadastrosResponse.ok) {
                            const cadastrosData = await cadastrosResponse.json();
                            cadastrosPendentes = cadastrosData.cadastros || cadastrosData.data || [];
                        }
                    } catch (e) {
                        cadastrosPendentes = [];
                    }
                }

                // Carregar quizzes
                try {
                    const quizzesResponse = await fetch(`${baseURL}/quizzes`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (quizzesResponse.ok) {
                        const quizzesData = await quizzesResponse.json();
                        const todosQuizzes = quizzesData.quizzes || quizzesData.data || [];
                        
                        quizzesAtivos = todosQuizzes.filter(q => q.status === 'ativo' || !q.status);
                        quizzesArquivados = todosQuizzes.filter(q => q.status === 'arquivado');
                        quizzesExcluidos = todosQuizzes.filter(q => q.status === 'excluido');
                    }
                } catch (e) {
                    quizzesAtivos = [];
                    quizzesArquivados = [];
                    quizzesExcluidos = [];
                }

                // Carregar PDFs
                try {
                    const pdfsResponse = await fetch(`${baseURL}/pdfs`, {
                        method: 'GET',
                        credentials: 'include'
                    });
                    
                    if (pdfsResponse.ok) {
                        const pdfsData = await pdfsResponse.json();
                        const todosPdfs = pdfsData.pdfs || pdfsData.data || [];
                        
                        pdfsAtivos = todosPdfs.filter(p => p.status === 'ativo' || !p.status);
                        pdfsArquivados = todosPdfs.filter(p => p.status === 'arquivado');
                        pdfsExcluidos = todosPdfs.filter(p => p.status === 'excluido');
                    }
                } catch (e) {
                    pdfsAtivos = [];
                    pdfsArquivados = [];
                    pdfsExcluidos = [];
                }

                updateDebug('Dados carregados com sucesso');
                
            } catch (error) {
                console.error('❌ Erro geral no carregamento:', error);
                updateDebug(`Erro: ${error.message}`);
                mostrarMensagemSucesso('⚠️ Alguns dados podem não estar atualizados');
            }
        }

        // ============================================================================
        // SISTEMA DE EXIBIÇÃO DE CONTEÚDO
        // ============================================================================
        function exibirConteudo() {
            quizzesContainer.innerHTML = '';

            switch (currentTab) {
                case 'ativos':
                    exibirQuizzesAtivos();
                    break;
                case 'arquivados':
                    exibirArquivados();
                    break;
                case 'lixeira':
                    exibirLixeira();
                    break;
                case 'usuarios':
                    exibirUsuarios();
                    break;
                case 'cadastros':
                    exibirCadastrosPendentes();
                    break;
                case 'pdfs':
                    exibirPDFs();
                    break;
                case 'calendario':
                    exibirCalendario();
                    break;
                case 'perfil':
                    exibirPerfil();
                    break;
                default:
                    quizzesContainer.innerHTML = '<p class="empty-message">Nenhum conteúdo disponível.</p>';
                    break;
            }
        }

        // ============================================================================
        // EXIBIÇÃO DE QUIZZES ATIVOS
        // ============================================================================
        function exibirQuizzesAtivos() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>🎯 Quizzes Ativos (${quizzesAtivos.length})</span>`;
            quizzesContainer.appendChild(title);

            if (quizzesAtivos.length === 0) {
                const emptyMsg = usuarioLogado.tipo === 'aluno' ? 
                    'Nenhum quiz disponível para jogar no momento.' :
                    'Nenhum quiz ativo. Clique em "Criar Quiz" para começar!';
                quizzesContainer.innerHTML += `<p class="empty-message">${emptyMsg}</p>`;
                return;
            }

            const grid = document.createElement('div');
            grid.className = 'items-grid';

            quizzesAtivos.forEach(quiz => {
                const card = criarCardQuiz(quiz, 'ativo');
                grid.appendChild(card);
            });

            quizzesContainer.appendChild(grid);
        }

        // ============================================================================
        // EXIBIÇÃO DE PDFs - CORRIGIDA COM CONTROLE DE DOWNLOAD
        // ============================================================================
        function exibirPDFs() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>📄 Gerenciar PDFs</span>`;
            quizzesContainer.appendChild(title);
            
            // Área de Upload - apenas para admin e moderador
            if (usuarioLogado.tipo === 'administrador' || usuarioLogado.tipo === 'moderador') {
                const uploadArea = document.createElement('div');
                uploadArea.className = 'upload-area';
                uploadArea.innerHTML = `
                    <h3 style="color: #0af; margin-bottom: 15px;">📤 Upload de PDF</h3>
                    <p style="color: #0af; margin-bottom: 15px;">Clique aqui ou arraste arquivos PDF para enviar</p>
                    <input type="file" id="pdfUpload" accept=".pdf" multiple style="display: none;">
                    <button onclick="document.getElementById('pdfUpload').click()" style="background: linear-gradient(45deg, #0af, #08c); color: #000; border: none; padding: 12px 24px; border-radius: 8px; font-weight: bold; cursor: pointer;">
                        📎 Selecionar PDFs
                    </button>
                `;
                
                uploadArea.addEventListener('click', () => {
                    document.getElementById('pdfUpload').click();
                });
                
                quizzesContainer.appendChild(uploadArea);
            }
            
            // Lista de PDFs Ativos
            if (pdfsAtivos.length > 0) {
                const pdfsTitle = document.createElement('h3');
                pdfsTitle.style.color = '#0af';
                pdfsTitle.style.margin = '30px 0 15px 0';
                pdfsTitle.textContent = `📄 PDFs Disponíveis (${pdfsAtivos.length})`;
                quizzesContainer.appendChild(pdfsTitle);

                const pdfsGrid = document.createElement('div');
                pdfsGrid.className = 'items-grid';

                pdfsAtivos.forEach(pdf => {
                    const card = criarCardPDF(pdf);
                    pdfsGrid.appendChild(card);
                });

                quizzesContainer.appendChild(pdfsGrid);
            } else {
                const emptyMessage = document.createElement('p');
                emptyMessage.className = 'empty-message';
                emptyMessage.textContent = usuarioLogado.tipo === 'aluno' ? 
                    'Nenhum PDF disponível para visualização.' :
                    'Nenhum PDF disponível. Faça upload de arquivos PDF para começar.';
                quizzesContainer.appendChild(emptyMessage);
            }
            
            // Configurar input de arquivo
            setTimeout(() => {
                const fileInput = document.getElementById('pdfUpload');
                if (fileInput) {
                    fileInput.addEventListener('change', (e) => {
                        handlePDFUpload(e.target.files);
                    });
                }
            }, 100);
        }

        // ============================================================================
        // EXIBIÇÃO DO CALENDÁRIO ACADÊMICO - NOVA VERSÃO COMPLETA
        // ============================================================================
        function exibirCalendario() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>📅 Calendário Acadêmico 2025</span>`;
            quizzesContainer.appendChild(title);
            
            const container = document.createElement('div');
            container.className = 'calendario-container';
            
            // Obter data atual e período ativo
            const hoje = new Date();
            const anoAtual = hoje.getFullYear();
            const periodoAtual = obterPeriodoAtual(hoje);
            
            container.innerHTML = `
                <div class="calendario-header">
                    <h2 style="color: #0af; margin: 0 0 20px 0; text-shadow: 0 0 20px rgba(0, 170, 255, 0.5);">
                        🎓 CRONOGRAMA ACADÊMICO ${anoAtual}
                    </h2>
                    <p style="color: #ccc; margin: 0; font-size: 1.1rem;">
                        Acompanhe os períodos letivos e datas importantes
                    </p>
                </div>

                <div class="status-atual">
                    <h3 style="margin: 0 0 10px 0; font-size: 1.3rem;">📍 SITUAÇÃO ATUAL</h3>
                    <div style="font-size: 1.1rem;">${periodoAtual.status}</div>
                    ${periodoAtual.periodo ? `<div style="margin-top: 10px; font-size: 1rem;">📚 ${periodoAtual.periodo.periodo}</div>` : ''}
                    ${periodoAtual.progresso ? `
                        <div style="margin-top: 15px;">
                            <div style="margin-bottom: 5px;">Progresso: ${periodoAtual.progresso}%</div>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${periodoAtual.progresso}%"></div>
                            </div>
                        </div>
                    ` : ''}
                </div>

                ${periodoAtual.countdown ? `
                    <div class="countdown-container">
                        <h4 style="color: #ffc107; margin: 0 0 10px 0;">⏰ CONTAGEM REGRESSIVA</h4>
                        <div class="countdown-time">${periodoAtual.countdown}</div>
                        <div style="margin-top: 5px; color: #ccc;">${periodoAtual.countdownLabel}</div>
                    </div>
                ` : ''}

                <div class="cronograma-grid">
                    ${Object.entries(calendarioAcademico["2025"]).map(([numero, periodo]) => `
                        <div class="periodo-card ${periodoAtual.numeroAtual === numero ? 'ativo' : ''}">
                            <div class="periodo-titulo">
                                ${numero === '1' ? '🌅' : numero === '2' ? '☀️' : '🍂'} ${periodo.periodo}
                            </div>
                            <div class="periodo-datas">
                                📅 ${formatarData(periodo.inicio)} a ${formatarData(periodo.fim)}
                            </div>
                            <div class="periodo-info">
                                📊 ${periodo.semanas} semanas letivas
                            </div>
                            ${periodoAtual.numeroAtual === numero && periodoAtual.progresso ? `
                                <div class="progress-bar" style="margin-top: 10px;">
                                    <div class="progress-fill" style="width: ${periodoAtual.progresso}%"></div>
                                </div>
                            ` : ''}
                            <div style="margin-top: 15px; font-size: 0.85rem; color: #999;">
                                ${periodo.detalhes.map(detalhe => `<div style="margin: 3px 0;">• ${detalhe}</div>`).join('')}
                            </div>
                        </div>
                    `).join('')}
                </div>

                <div style="margin-top: 30px; padding: 20px; background: rgba(0, 170, 255, 0.05); border-radius: 15px; border: 1px solid rgba(0, 170, 255, 0.2);">
                    <h4 style="color: #0af; margin: 0 0 15px 0;">📋 INFORMAÇÕES IMPORTANTES</h4>
                    <div style="color: #ccc; font-size: 0.95rem; line-height: 1.6;">
                        <div>• <strong>Matrícula:</strong> Deve ser renovada antes do início de cada período</div>
                        <div>• <strong>Avaliações:</strong> Duas avaliações por disciplina em cada período</div>
                        <div>• <strong>Frequência:</strong> Mínimo de 75% de presença obrigatória</div>
                        <div>• <strong>Recuperação:</strong> Para alunos com nota entre 4,0 e 6,9</div>
                        <div>• <strong>Rematrícula:</strong> Alunos reprovados devem se rematricular</div>
                    </div>
                </div>
            `;
            
            quizzesContainer.appendChild(container);
        }

        // ============================================================================
        // FUNÇÕES AUXILIARES DO CALENDÁRIO
        // ============================================================================
        function obterPeriodoAtual(hoje) {
            const ano = hoje.getFullYear().toString();
            const dataAtual = hoje.toISOString().split('T')[0];
            
            if (!calendarioAcademico[ano]) {
                return {
                    status: "📅 Calendário não disponível para " + ano,
                    periodo: null,
                    progresso: null,
                    countdown: null,
                    numeroAtual: null
                };
            }
            
            for (const [numero, periodo] of Object.entries(calendarioAcademico[ano])) {
                const inicio = new Date(periodo.inicio);
                const fim = new Date(periodo.fim);
                const agora = new Date(dataAtual);
                
                if (agora >= inicio && agora <= fim) {
                    // Estamos dentro do período
                    const totalDias = Math.ceil((fim - inicio) / (1000 * 60 * 60 * 24));
                    const diasPassados = Math.ceil((agora - inicio) / (1000 * 60 * 60 * 24));
                    const progresso = Math.round((diasPassados / totalDias) * 100);
                    
                    const diasRestantes = Math.ceil((fim - agora) / (1000 * 60 * 60 * 24));
                    
                    return {
                        status: `✅ ${periodo.periodo} em andamento`,
                        periodo: periodo,
                        progresso: progresso,
                        countdown: `${diasRestantes} dias`,
                        countdownLabel: "para o fim do período",
                        numeroAtual: numero
                    };
                } else if (agora < inicio) {
                    // Período ainda não começou
                    const diasRestantes = Math.ceil((inicio - agora) / (1000 * 60 * 60 * 24));
                    
                    return {
                        status: `⏳ Aguardando ${periodo.periodo}`,
                        periodo: periodo,
                        progresso: null,
                        countdown: `${diasRestantes} dias`,
                        countdownLabel: "para o início do período",
                        numeroAtual: numero
                    };
                }
            }
            
            // Se chegou aqui, todos os períodos já terminaram ou estamos em recesso
            return {
                status: "🏖️ Período de recesso/férias",
                periodo: null,
                progresso: null,
                countdown: null,
                numeroAtual: null
            };
        }

        function formatarData(dataString) {
            const data = new Date(dataString + 'T00:00:00');
            return data.toLocaleDateString('pt-BR', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        }

        // ============================================================================
        // CRIAÇÃO DE CARDS
        // ============================================================================
        function criarCardQuiz(quiz, status) {
            const card = document.createElement('div');
            card.className = 'quiz-card';

            if (quiz.imagem || quiz.imagemBase64) {
                const img = document.createElement('img');
                img.src = quiz.imagem || quiz.imagemBase64;
                img.alt = quiz.nome || quiz.titulo;
                img.className = 'quiz-image';
                card.appendChild(img);
            }

            const title = document.createElement('div');
            title.className = 'quiz-title';
            title.textContent = quiz.nome || quiz.titulo;
            card.appendChild(title);

            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#666';
            info.innerHTML = `
                <div>📊 ${quiz.perguntas?.length || 0} perguntas</div>
                <div>📅 Criado: ${new Date(quiz.dataCriacao || Date.now()).toLocaleDateString('pt-BR')}</div>
                <div>🎯 Status: ${status}</div>
            `;
            card.appendChild(info);

            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            
            if (status === 'ativo') {
                if (usuarioLogado.tipo === 'aluno') {
                    actions.innerHTML = `
                        <button class="action-btn btn-view" onclick="jogarQuiz('${quiz.id}')">🎮 Jogar Quiz</button>
                    `;
                } else {
                    actions.innerHTML = `
                        <button class="action-btn btn-view" onclick="jogarQuiz('${quiz.id}')">🎮 Jogar</button>
                        <button class="action-btn btn-edit" onclick="editarQuiz('${quiz.id}')">✏️ Editar</button>
                        <button class="action-btn btn-archive" onclick="arquivarQuiz('${quiz.id}')">📁 Arquivar</button>
                        <button class="action-btn btn-delete" onclick="excluirQuiz('${quiz.id}')">🗑️ Excluir</button>
                    `;
                }
                
                card.onclick = (e) => {
                    if (e.target.tagName !== 'BUTTON') {
                        jogarQuiz(quiz.id);
                    }
                };
            }
            
            card.appendChild(actions);
            return card;
        }

        function criarCardPDF(pdf) {
            const card = document.createElement('div');
            card.className = 'pdf-card';

            // Status do download (bloqueado por padrão)
            const downloadBloqueado = pdf.downloadBloqueado !== false; // Por padrão é true
            
            const statusDiv = document.createElement('div');
            statusDiv.className = `pdf-status ${downloadBloqueado ? 'status-bloqueado' : 'status-desbloqueado'}`;
            statusDiv.textContent = downloadBloqueado ? '🔒 Download Bloqueado' : '🔓 Download Liberado';
            card.appendChild(statusDiv);

            const title = document.createElement('div');
            title.className = 'pdf-card-name';
            title.textContent = pdf.nome || pdf.titulo || 'PDF sem nome';
            card.appendChild(title);

            const info = document.createElement('div');
            info.style.fontSize = '0.9rem';
            info.style.color = '#666';
            info.innerHTML = `
                <div>📄 Tipo: PDF</div>
                <div>📅 Enviado: ${new Date(pdf.dataUpload || Date.now()).toLocaleDateString('pt-BR')}</div>
                <div>👤 Por: ${pdf.usuarioUpload || 'Sistema'}</div>
            `;
            card.appendChild(info);

            const actions = document.createElement('div');
            actions.className = 'action-buttons';
            
            let actionsHTML = `
                <button class="action-btn btn-view" onclick="visualizarPDF('${pdf.id}')">👁️ Visualizar</button>
            `;

            // Botão de download - habilitado/desabilitado baseado no status
            if (downloadBloqueado) {
                actionsHTML += `
                    <button class="action-btn btn-download disabled" title="Download bloqueado pelo administrador">
                        🚫 Download Bloqueado
                    </button>
                `;
            } else {
                actionsHTML += `
                    <button class="action-btn btn-download" onclick="baixarPDF('${pdf.id}')">
                        💾 Download
                    </button>
                `;
            }

            // Controles para admin
            if (usuarioLogado.tipo === 'administrador') {
                if (downloadBloqueado) {
                    actionsHTML += `
                        <button class="action-btn btn-unlock" onclick="desbloquearDownloadPDF('${pdf.id}')">
                            🔓 Liberar Download
                        </button>
                    `;
                } else {
                    actionsHTML += `
                        <button class="action-btn btn-lock" onclick="bloquearDownloadPDF('${pdf.id}')">
                            🔒 Bloquear Download
                        </button>
                    `;
                }
                
                actionsHTML += `
                    <button class="action-btn btn-delete" onclick="excluirPDF('${pdf.id}')">🗑️ Excluir</button>
                `;
            }
            
            actions.innerHTML = actionsHTML;
            card.appendChild(actions);
            
            return card;
        }

        // ============================================================================
        // OUTRAS FUNÇÕES DE EXIBIÇÃO (simplificadas)
        // ============================================================================
        function exibirArquivados() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>📁 Itens Arquivados</span>`;
            quizzesContainer.appendChild(title);
            quizzesContainer.innerHTML += '<p class="empty-message">Função em desenvolvimento.</p>';
        }

        function exibirLixeira() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>🗑️ Lixeira</span>`;
            quizzesContainer.appendChild(title);
            quizzesContainer.innerHTML += '<p class="empty-message">Função em desenvolvimento.</p>';
        }

        function exibirUsuarios() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>👥 Usuários Ativos (${users.length})</span>`;
            quizzesContainer.appendChild(title);
            quizzesContainer.innerHTML += '<p class="empty-message">Lista de usuários em desenvolvimento.</p>';
        }

        function exibirCadastrosPendentes() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>⏳ Cadastros Pendentes (${cadastrosPendentes.length})</span>`;
            quizzesContainer.appendChild(title);
            quizzesContainer.innerHTML += '<p class="empty-message">Lista de cadastros pendentes em desenvolvimento.</p>';
        }

        function exibirPerfil() {
            const title = document.createElement('div');
            title.className = 'section-title';
            title.innerHTML = `<span>👤 Meu Perfil</span>`;
            quizzesContainer.appendChild(title);
            
            const container = document.createElement('div');
            container.style.cssText = `
                background: rgba(17, 17, 17, 0.9);
                border-radius: 15px;
                padding: 30px;
                margin: 20px auto;
                max-width: 600px;
                border: 1px solid rgba(0, 170, 255, 0.3);
                text-align: center;
            `;
            
            container.innerHTML = `
                <div style="color: #0af; font-size: 1.5rem; margin-bottom: 20px;">
                    👤 ${usuarioLogado.nome}
                </div>
                <div style="color: #ccc; margin-bottom: 10px;">
                    @${usuarioLogado.usuario}
                </div>
                <div style="display: inline-block; padding: 5px 15px; background: linear-gradient(45deg, #0af, #08c); color: #000; border-radius: 20px; font-weight: bold; text-transform: uppercase;">
                    ${usuarioLogado.tipo}
                </div>
                <div style="margin-top: 20px; color: #666;">
                    Email: ${usuarioLogado.email || 'Não informado'}
                </div>
            `;
            
            quizzesContainer.appendChild(container);
        }

        // ============================================================================
        // FUNÇÕES DE AÇÃO DOS PDFs
        // ============================================================================
        function visualizarPDF(pdfId) {
            // Abrir PDF no visualizador (sem opção de download)
            const pdfViewer = document.getElementById('pdfViewer');
            const pdfFrame = document.getElementById('pdfFrame');
            
            // URL do PDF do backend
            pdfFrame.src = `https://brainquiz-backend.onrender.com/api/pdfs/${pdfId}/view`;
            pdfViewer.style.display = 'flex';
            
            mostrarMensagemSucesso('📄 Abrindo PDF...');
        }

        function baixarPDF(pdfId) {
            // Fazer download do PDF
            const link = document.createElement('a');
            link.href = `https://brainquiz-backend.onrender.com/api/pdfs/${pdfId}/download`;
            link.download = '';
            link.click();
            
            mostrarMensagemSucesso('💾 Iniciando download...');
        }

        async function bloquearDownloadPDF(pdfId) {
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdfs/${pdfId}/bloquear-download`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    mostrarMensagemSucesso('🔒 Download bloqueado com sucesso!');
                    await carregarDadosBackend();
                    exibirPDFs();
                } else {
                    mostrarMensagemSucesso('❌ Erro ao bloquear download');
                }
            } catch (error) {
                mostrarMensagemSucesso('❌ Erro de conexão');
            }
        }

        async function desbloquearDownloadPDF(pdfId) {
            try {
                const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdfs/${pdfId}/desbloquear-download`, {
                    method: 'POST',
                    credentials: 'include'
                });
                
                if (response.ok) {
                    mostrarMensagemSucesso('🔓 Download liberado com sucesso!');
                    await carregarDadosBackend();
                    exibirPDFs();
                } else {
                    mostrarMensagemSucesso('❌ Erro ao liberar download');
                }
            } catch (error) {
                mostrarMensagemSucesso('❌ Erro de conexão');
            }
        }

        function fecharVisualizadorPDF() {
            const pdfViewer = document.getElementById('pdfViewer');
            const pdfFrame = document.getElementById('pdfFrame');
            
            pdfViewer.style.display = 'none';
            pdfFrame.src = '';
        }

        async function handlePDFUpload(files) {
            if (!files || files.length === 0) return;
            
            for (const file of files) {
                if (file.type !== 'application/pdf') {
                    mostrarMensagemSucesso('❌ Apenas arquivos PDF são permitidos!');
                    continue;
                }
                
                const formData = new FormData();
                formData.append('pdf', file);
                formData.append('nome', file.name);
                
                try {
                    mostrarMensagemSucesso('📤 Enviando ' + file.name + '...');
                    
                    const response = await fetch('https://brainquiz-backend.onrender.com/api/pdfs/upload', {
                        method: 'POST',
                        credentials: 'include',
                        body: formData
                    });
                    
                    if (response.ok) {
                        mostrarMensagemSucesso('✅ ' + file.name + ' enviado com sucesso!');
                    } else {
                        mostrarMensagemSucesso('❌ Erro ao enviar ' + file.name);
                    }
                } catch (error) {
                    mostrarMensagemSucesso('❌ Erro de conexão ao enviar ' + file.name);
                }
            }
            
            // Recarregar dados após upload
            await carregarDadosBackend();
            exibirPDFs();
        }

        // ============================================================================
        // FUNÇÕES DE AÇÃO DOS QUIZZES
        // ============================================================================
        function jogarQuiz(quizId) {
            window.location.href = `quiz.html?id=${quizId}`;
        }

        function editarQuiz(quizId) {
            window.location.href = `painel.html?edit=${quizId}`;
        }

        async function arquivarQuiz(quizId) {
            if (confirm('Deseja arquivar este quiz?')) {
                try {
                    const response = await fetch(`https://brainquiz-backend.onrender.com/api/quizzes/${quizId}/arquivar`, {
                        method: 'POST',
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        mostrarMensagemSucesso('📁 Quiz arquivado com sucesso!');
                        await carregarDadosBackend();
                        exibirQuizzesAtivos();
                    } else {
                        mostrarMensagemSucesso('❌ Erro ao arquivar quiz');
                    }
                } catch (error) {
                    mostrarMensagemSucesso('❌ Erro de conexão');
                }
            }
        }

        async function excluirQuiz(quizId) {
            if (confirm('Deseja excluir este quiz?')) {
                try {
                    const response = await fetch(`https://brainquiz-backend.onrender.com/api/quizzes/${quizId}/excluir`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        mostrarMensagemSucesso('🗑️ Quiz excluído com sucesso!');
                        await carregarDadosBackend();
                        exibirQuizzesAtivos();
                    } else {
                        mostrarMensagemSucesso('❌ Erro ao excluir quiz');
                    }
                } catch (error) {
                    mostrarMensagemSucesso('❌ Erro de conexão');
                }
            }
        }

        async function excluirPDF(pdfId) {
            if (confirm('Deseja excluir este PDF?')) {
                try {
                    const response = await fetch(`https://brainquiz-backend.onrender.com/api/pdfs/${pdfId}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });
                    
                    if (response.ok) {
                        mostrarMensagemSucesso('🗑️ PDF excluído com sucesso!');
                        await carregarDadosBackend();
                        exibirPDFs();
                    } else {
                        mostrarMensagemSucesso('❌ Erro ao excluir PDF');
                    }
                } catch (error) {
                    mostrarMensagemSucesso('❌ Erro de conexão');
                }
            }
        }

        // ============================================================================
        // INICIALIZAÇÃO PRINCIPAL
        // ============================================================================
        (async () => {
            try {
                updateDebug('Inicializando sistema...');
                
                mostrarLoading('Verificando autenticação...');
                
                const usuarioValido = await verificarUsuarioLogado();
                if (!usuarioValido) {
                    return;
                }
                
                mostrarLoading('Carregando dados do sistema...');
                await carregarDadosBackend();
                
                mostrarLoading('Configurando interface...');
                configurarBotoesPrincipais();
                configurarTabs();
                
                exibirConteudo();
                
                updateDebug(`Sistema pronto - ${usuarioLogado.nome}`);
                mostrarMensagemSucesso(`✨ Bem-vindo, ${usuarioLogado.nome}! Dashboard carregado.`);
                
            } catch (error) {
                console.error('❌ Erro na inicialização:', error);
                updateDebug(`Erro: ${error.message}`);
                
                quizzesContainer.innerHTML = `
                    <div class="error">
                        <h3>❌ Erro na Inicialização</h3>
                        <p>Erro: ${error.message}</p>
                        <p>Tente recarregar a página ou entre em contato com o suporte.</p>
                        <button onclick="window.location.reload()" style="background: linear-gradient(45deg, #0af, #08c); color: #000; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin-top: 10px;">
                            🔄 Recarregar Página
                        </button>
                    </div>
                `;
            }
        })();

        // Iniciar animação de partículas
        document.addEventListener('DOMContentLoaded', () => {
            criarParticulas();
        });

        // Fechar visualizador de PDF com ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                const pdfViewer = document.getElementById('pdfViewer');
                if (pdfViewer.style.display === 'flex') {
                    fecharVisualizadorPDF();
                }
            }
        });

        console.log('🎯 DASHBOARD BrainQuiz - CORRIGIDO E FUNCIONAL!');
        console.log('✅ Principais correções implementadas:');
        console.log('   📋 1. Abas funcionais restauradas');
        console.log('   📄 2. Sistema de PDF com controle de download');
        console.log('   📅 3. Calendário acadêmico completo e em tempo real');
        console.log('   👥 4. Controle de acesso por tipo de usuário');
        console.log('   🔧 5. Código limpo e organizado');
        console.log('   🎨 6. Interface responsiva e moderna');

    </script>
</body>
</html>
